<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>时间重叠分析工具</title>
    <script>
        function timeToSeconds(time) {
            if (!time) return 0;
            const [hours, minutes, seconds] = time.split(':').map(Number);
            return hours * 3600 + minutes * 60 + seconds;
        }

        function calculateOverlap(start1, end1, start2, end2) {
            const start = Math.max(timeToSeconds(start1), timeToSeconds(start2));
            const end = Math.min(timeToSeconds(end1), timeToSeconds(end2));
            return Math.max(0, end - start);
        }

        function analyzeJSON() {
            const input = document.getElementById('jsonInput').value;
            let data;
            try {
                data = JSON.parse(input);
            } catch (e) {
                alert('无效的 JSON 数据');
                return;
            }

            let totalOverlap = 0;
            let totalArtificialTime = 0;
            let totalActualTime = 0;
            let matchedSegments = 0;
            let totalSegments = 0;

            data.forEach(item => {
                if (item['起止时间'] && item['人工时间']) {
                    const [actualStart, actualEnd] = item['起止时间'].split(' - ');
                    const [artificialStart, artificialEnd] = item['人工时间'].split(' - ');
                    const overlap = calculateOverlap(actualStart, actualEnd, artificialStart, artificialEnd);
                    const actualDuration = timeToSeconds(actualEnd) - timeToSeconds(actualStart);
                    const artificialDuration = timeToSeconds(artificialEnd) - timeToSeconds(artificialStart);
                    
                    totalOverlap += overlap;
                    totalArtificialTime += artificialDuration;
                    totalActualTime += actualDuration;
                    totalSegments++;

                    if (overlap > 0) matchedSegments++;
                }
            });

            const precision = totalOverlap / totalArtificialTime || 0;
            const recall = totalOverlap / totalActualTime || 0;
            const f1 = precision && recall ? 2 * (precision * recall) / (precision + recall) : 0;

            document.getElementById('result').innerHTML = `
                <p><strong>总重叠时间：</strong> ${totalOverlap} 秒</p>
                <p><strong>准确率：</strong> ${(precision * 100).toFixed(2)}%</p>
                <p><strong>召回率：</strong> ${(recall * 100).toFixed(2)}%</p>
                <p><strong>F1 分数：</strong> ${(f1 * 100).toFixed(2)}</p>
            `;
        }
    </script>
</head>
<body>
    <h1>时间重叠分析工具</h1>
    <textarea id="jsonInput" rows="15" cols="80" placeholder="请粘贴 JSON 数据"></textarea><br>
    <button onclick="analyzeJSON()">分析</button>
    <div id="result"></div>
</body>
</html>
